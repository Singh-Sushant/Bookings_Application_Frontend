<div>
  <div class="flex justify-between items-center px-4 py-3">
    <!-- User Authentication and Navigation -->
    @if (loggedIn) {
      <button class="bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-700" (click)="navigateToUrl()">Check your bookings</button>
    } @else {
      <h2 class="text-lg font-semibold">Login to see your bookings</h2>
    }
    <div class="flex items-center space-x-4">
      @if(!loggedIn) {
        <button class="border border-gray-800 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-800 hover:text-white" (click)="goToSignup()">Sign Up</button>
        <button class="border border-gray-800 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-800 hover:text-white" (click)="goToLogin()">Login</button>
      } @else {
        <button class="border border-red-600 text-red-600 px-4 py-2 rounded-md hover:bg-red-600 hover:text-white" (click)="doLogout()">Logout</button>
        <div class="relative" (click)="toggleUserMenu()">
          <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center cursor-pointer">
            {{ userInitial }}
          </div>
          <div class="flex w-20 items-center justify-center absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10" *ngIf="showUserMenu">
            <button href="#" class=" block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" (click)="goToProfile()">Profile</button>
          </div>
        </div>
      }
    </div>
  </div>
</div>

<h1 class="text-center text-2xl font-bold mt-6 mb-10">Event Listings</h1>
<div *ngIf="loader" class="text-center my-8">
  <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
</div>

<div *ngIf="!loader" class="container mx-auto px-4">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    <div *ngFor="let item of allEvents; let i = index;" class="bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 hover:scale-105">
      <!-- Image Carousel -->
      <div class="relative h-64 overflow-hidden">
        <ng-container *ngIf="item.eventImage && item.eventImage.length > 1; else singleImage">
          <div class="flex transition-transform duration-500 ease-in-out" [style.transform]="'translateX(-' + (currentImageIndex[i] * 100) + '%)'">
            <img *ngFor="let image of item.eventImage" [src]="image" alt="{{ item.name }}" class="w-full h-64 object-cover">
          </div>
          <!-- Changed: Pass index to prevImage and nextImage methods -->
          <button (click)="prevImage(i)" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full">←</button>
          <button (click)="nextImage(i)" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full">→</button>
        </ng-container>
        <ng-template #singleImage>
          <img [src]="item.eventImage[0]" alt="{{ item.name }}" class="w-full h-64 object-cover">
        </ng-template>
      </div>
    
      <div class="p-6">
        <div class="flex justify-between flex-col gap-2 items-center mb-4">
          <h2 class="text-xl font-semibold">{{ item.name }}</h2>
          <div class="flex space-x-2">
            <span *ngFor="let category of item.category" class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
              {{ category }}
            </span>
          </div>
        </div>
        <p class="text-gray-600 mb-4">{{ item.description }}</p>
        <ul class="space-y-2">
          <li><span class="font-semibold">Artist:</span> {{ item.artist }}</li>
          <li><span class="font-semibold">Date-Time:</span> {{ item.dateTime | date:'fullDate' }} at {{ item.dateTime | date:'shortTime' }}</li>
          <li><span class="font-semibold">Venue:</span> {{ item.venue }}</li>
          <li><span class="font-semibold">Total Tickets:</span> {{ item.totalTickets }}</li>
        </ul>
      </div>
    
      <div class="bg-gray-100 px-6 py-4">
        <!-- Changed: Loop through ticket types and create a button for each -->
        <div *ngFor="let ticketType of item.ticketTypes">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">{{ ticketType.type }} - Rs.{{ ticketType.price }}</span>
            <span class="text-gray-500">{{ ticketType.availableNoOfTickets > 0 ? ticketType.availableNoOfTickets + ' available' : 'SOLD OUT' }}</span>
            <!-- Changed: Small book button for each ticket type -->
            <button *ngIf="ticketType.availableNoOfTickets > 0" 
                    class="bg-blue-600 text-white px-2 py-1 text-sm rounded-md hover:bg-blue-700 transition-colors duration-300" 
                    (click)="onBookClicked()">Book</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
